<?php
require 'csrf.php'; 
require 'auth.php';
require 'access_control.php';
session_start();
if (!isset($_SESSION["admin_logged_in"])) {
    header("Location: admin_login.php");
        exit;
        }
        $pageTitle = "الصور والشعارات";
        require 'config.php';

        // عند تقديم النموذج، نقوم بمعالجة رفع الملفات وتحديث الصور
        $message = '';
        if ($_SERVER["REQUEST_METHOD"] === "POST") {
            // مسار مجلد الصور (تأكد من ضبط الصلاحيات على هذا المجلد)
                $uploadDir = 'sor/';
                    
                        // تحديث شعار الموقع
                            if (isset($_FILES['logo']) && $_FILES['logo']['error'] === UPLOAD_ERR_OK) {
                                    $logoTmp  = $_FILES['logo']['tmp_name'];
                                            $logoName = $_FILES['logo']['name'];
                                                    $logoExt  = strtolower(pathinfo($logoName, PATHINFO_EXTENSION));
                                                            // تحديد الأنواع المسموح بها (png, jpg, jpeg, gif)
                                                                    if (in_array($logoExt, ['png','jpg','jpeg','gif'])) {
                                                                                // استبدال الشعار الحالي للموقع (نفترض أنه مسمى logo.png)
                                                                                            $destPath = $uploadDir . 'logo.png';
                                                                                                        if (move_uploaded_file($logoTmp, $destPath)) {
                                                                                                                        $message .= 'تم تحديث الشعار بنجاح.<br>';
                                                                                                                                    } else {
                                                                                                                                                    $message .= 'حدث خطأ أثناء تحديث الشعار.<br>';
                                                                                                                                                                }
                                                                                                                                                                        } else {
                                                                                                                                                                                    $message .= 'نوع ملف الشعار غير مسموح به.<br>';
                                                                                                                                                                                            }
                                                                                                                                                                                                }
                                                                                                                                                                                                    
                                                                                                                                                                                                        // تحديث شعار صفحة تسجيل الدخول (المسار الجديد: sor/lol.png)
                                                                                                                                                                                                            if (isset($_FILES['login_logo']) && $_FILES['login_logo']['error'] === UPLOAD_ERR_OK) {
                                                                                                                                                                                                                    $loginLogoTmp  = $_FILES['login_logo']['tmp_name'];
                                                                                                                                                                                                                            $loginLogoName = $_FILES['login_logo']['name'];
                                                                                                                                                                                                                                    $loginLogoExt  = strtolower(pathinfo($loginLogoName, PATHINFO_EXTENSION));
                                                                                                                                                                                                                                            if (in_array($loginLogoExt, ['png','jpg','jpeg','gif'])) {
                                                                                                                                                                                                                                                        // استبدال شعار صفحة تسجيل الدخول (المسار: sor/lol.png)
                                                                                                                                                                                                                                                                    $destPath = $uploadDir . 'lol.png';
                                                                                                                                                                                                                                                                                if (move_uploaded_file($loginLogoTmp, $destPath)) {
                                                                                                                                                                                                                                                                                                $message .= 'تم تحديث شعار صفحة تسجيل الدخول بنجاح.<br>';
                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                            $message .= 'حدث خطأ أثناء تحديث شعار صفحة تسجيل الدخول.<br>';
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                            $message .= 'نوع ملف شعار صفحة تسجيل الدخول غير مسموح به.<br>';
                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                // تحديث صور الكاروسيل (نفترض 12 صورة باسم khaleefa1.jpg إلى khaleefa12.jpg)
                                                                                                                                                                                                                                                                                                                                                                                    for ($i = 1; $i <= 12; $i++) {
                                                                                                                                                                                                                                                                                                                                                                                            $fieldName = 'carousel_image_' . $i;
                                                                                                                                                                                                                                                                                                                                                                                                    if (isset($_FILES[$fieldName]) && $_FILES[$fieldName]['error'] === UPLOAD_ERR_OK) {
                                                                                                                                                                                                                                                                                                                                                                                                                $imgTmp  = $_FILES[$fieldName]['tmp_name'];
                                                                                                                                                                                                                                                                                                                                                                                                                            $imgName = $_FILES[$fieldName]['name'];
                                                                                                                                                                                                                                                                                                                                                                                                                                        $imgExt  = strtolower(pathinfo($imgName, PATHINFO_EXTENSION));
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (in_array($imgExt, ['png','jpg','jpeg','gif'])) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    $destPath = $uploadDir . 'khaleefa' . $i . '.jpg';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (move_uploaded_file($imgTmp, $destPath)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        $message .= "تم تحديث صورة الكاروسيل رقم $i بنجاح.<br>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            $message .= "حدث خطأ أثناء تحديث صورة الكاروسيل رقم $i.<br>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        $message .= "نوع ملف صورة الكاروسيل رقم $i غير مسموح به.<br>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                include 'header.php';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ?>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="container my-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <h2 class="text-center mb-4">إدارة الصور والشعارات</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <?php if ($message): ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="alert alert-info text-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?php echo $message; ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <?php endif; ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <form action="images_logos.php" method="POST" enctype="multipart/form-data">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <!-- قسم تغيير شعار الموقع -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="card mb-4 shadow-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="card-header bg-primary text-white">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <h4>تغيير شعار الموقع</h4>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="card-body">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="mb-3 text-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <label class="form-label">الشعار الحالي:</label><br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <?php 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                $logoPath  = 'sor/logo.png';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            $logoQuery = file_exists($logoPath) ? '?' . filemtime($logoPath) : '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img src="<?php echo $logoPath . $logoQuery; ?>" alt="الشعار الحالي" style="max-width:150px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="mb-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <label class="form-label">اختر شعار جديد:</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <input type="file" name="logo" class="form-control" accept="image/*">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <!-- قسم تغيير شعار صفحة تسجيل الدخول -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="card mb-4 shadow-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="card-header bg-info text-white">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <h4>تغيير شعار صفحة تسجيل الدخول</h4>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="card-body">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="mb-3 text-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label class="form-label">الشعار الحالي لصفحة الدخول:</label><br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <?php 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    $loginLogoPath  = 'sor/lol.png';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                $loginLogoQuery = file_exists($loginLogoPath) ? '?' . filemtime($loginLogoPath) : '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <img src="<?php echo $loginLogoPath . $loginLogoQuery; ?>" alt="شعار صفحة الدخول" style="max-width:150px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="mb-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label class="form-label">اختر شعار جديد لصفحة الدخول:</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <input type="file" name="login_logo" class="form-control" accept="image/*">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <!-- قسم تغيير صور الكاروسيل -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="card mb-4 shadow-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="card-header bg-secondary text-white">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <h4>تغيير صور الكاروسيل (أعمالنا)</h4>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="card-body">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <?php for($i = 1; $i <= 12; $i++): ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="mb-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label class="form-label">الصورة رقم <?php echo $i; ?>:</label><br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <?php 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        $carouselPath  = 'sor/khaleefa' . $i . '.jpg';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $carouselQuery = file_exists($carouselPath) ? '?' . filemtime($carouselPath) : '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <img src="<?php echo $carouselPath . $carouselQuery; ?>" alt="الصورة رقم <?php echo $i; ?>" style="max-width:150px;"><br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <input type="file" name="carousel_image_<?php echo $i; ?>" class="form-control mt-2" accept="image/*">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <?php endfor; ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="text-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button type="submit" class="btn btn-success btn-lg">حفظ التغييرات</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <a href="site_management.php" class="btn btn-secondary btn-lg">عودة</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </form>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <?php include 'footer.php'; ?>